<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Windows PowerShell进阶(22) IO操作之写入"><meta name="keywords" content="进阶,IO,Write"><meta name="author" content="超速蜗牛,undefined"><meta name="copyright" content="超速蜗牛"><title>Windows PowerShell进阶(22) IO操作之写入【超速蜗牛的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"AOHMI93W80","apiKey":"3f74c7e8113768c69c3eedfd6540618f","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#用法"><span class="toc-number">1.</span> <span class="toc-text">用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gt-amp-gt-gt"><span class="toc-number">1.1.</span> <span class="toc-text">&gt; &amp; &gt;&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#out-file"><span class="toc-number">1.2.</span> <span class="toc-text">out-file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#add-content"><span class="toc-number">1.3.</span> <span class="toc-text">add-content</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-content"><span class="toc-number">1.4.</span> <span class="toc-text">set-content</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#System-IO-File-WriteAllText"><span class="toc-number">1.5.</span> <span class="toc-text">[System.IO.File]::WriteAllText()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#System-IO-File-WriteAllLines"><span class="toc-number">1.6.</span> <span class="toc-text">[System.IO.File]::WriteAllLines()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#System-IO-File-WriteAllBytes"><span class="toc-number">1.7.</span> <span class="toc-text">[System.IO.File]::WriteAllBytes()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区别"><span class="toc-number">2.</span> <span class="toc-text">区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#文件锁"><span class="toc-number">2.1.</span> <span class="toc-text">文件锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Encoding"><span class="toc-number">2.2.</span> <span class="toc-text">Encoding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#格式化"><span class="toc-number">2.3.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件不存在时创建文件"><span class="toc-number">2.4.</span> <span class="toc-text">文件不存在时创建文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#管道"><span class="toc-number">2.5.</span> <span class="toc-text">管道</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">超速蜗牛</div><div class="author-info-description">Learn PowerShell.</div><div class="links-buttons"><a class="links-button button-hover" href="https://gitee.com/chaoyuew" target="_blank">Gitee<i class="icon-dot bg-color7"></i></a><a class="links-button button-hover" href="mailto:348001390@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color0"></i></a><a class="links-button button-hover" href="tencent://message/?uin=348001390&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color8"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">26</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">34</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">超速蜗牛的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Windows PowerShell进阶(22) IO操作之写入</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-08-25 | 更新于 2019-08-25</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/powershell/">powershell</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/进阶/">进阶</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/IO/">IO</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Write/">Write</a></div></div></div><div class="main-content"><p>本文首发于本人公众号SPPS178,现搬运过来,较原文有所改动.</p>
<p>今天接着讲IO 操作的第二部分:写入。</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>目前我所知道的powershell有以下几种写入命令: 不要混着用</p>
<h4 id="gt-amp-gt-gt"><a href="#gt-amp-gt-gt" class="headerlink" title="&gt; &amp; &gt;&gt;"></a>&gt; &amp; &gt;&gt;</h4><p>默认Unicode encoding,文件不存在时,会创建文件.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="string">"string from &gt; overwrites string to a file"</span> &gt; .\test.txt ; notepad .\test.txt <span class="comment"># 覆盖(&gt;)原有文件</span></span><br><span class="line">PS C:\Users\SPPS&gt; <span class="string">"string from &gt;&gt; appends string to a file"</span> &gt;&gt; .\test.txt ; notepad .\test.txt <span class="comment"># 添加(&gt;&gt;)到原有文件</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>重定向符号,熟悉Linux shell的应该不陌生,最基本的stream流redirection.  这个之前有提到过<a href="https://chaoyuew.gitee.io/WPS-12-Basic-Error-Variable-Redirection.html">Windows PowerShell入门(12) 错误相关系统变量，重定向</a></p>
<h4 id="out-file"><a href="#out-file" class="headerlink" title="out-file"></a>out-file</h4><p>覆盖或者添加(<code>-append</code>参数)文本到文件,可以指定-Encoding,默认Unicode,文件不存在时,会创建文件.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="built_in">out-file</span> -? </span><br><span class="line">SYNTAX</span><br><span class="line">    <span class="built_in">Out-File</span> [-FilePath] &lt;string&gt; [[-Encoding] &lt;string&gt; &#123;unknown | string | unicode | bigendianunicode | utf8 | utf7 | utf32 | ascii | default | oem&#125;] [-Append] [-Force] [-NoClobber] [-Width </span><br><span class="line">    &lt;int&gt;] [-NoNewline] [-InputObject &lt;psobject&gt;] [-WhatIf] [-Confirm]  [&lt;CommonParameters&gt;]</span><br><span class="line">    <span class="built_in">Out-File</span> [[-Encoding] &lt;string&gt; &#123;unknown | string | unicode | bigendianunicode | utf8 | utf7 | utf32 | ascii | default | oem&#125;] -LiteralPath &lt;string&gt; [-Append] [-Force] [-NoClobber] [-Width </span><br><span class="line">    &lt;int&gt;] [-NoNewline] [-InputObject &lt;psobject&gt;] [-WhatIf] [-Confirm]  [&lt;CommonParameters&gt;]</span><br><span class="line">PS C:\Users\SPPS&gt; <span class="string">"Out-File cmdlets will either overwrite or append string to a file"</span>| `</span><br><span class="line"><span class="built_in">Out-File</span> -FilePath .\test.txt -Append -Encoding utf8 -Force -ea <span class="number">1</span></span><br><span class="line">PS C:\Users\SPPS&gt; notepad .\test.txt</span><br></pre></td></tr></table></figure>

<p>按照微软官方的说法: &gt; 和不带任何参数的out-file效果一样</p>
<blockquote>
<p>The Out-File cmdlets sends output to a file. You can use this cmdlets instead of the redirection operator (&gt;) when you need to use its parameters.</p>
</blockquote>
<h4 id="add-content"><a href="#add-content" class="headerlink" title="add-content"></a>add-content</h4><p>添加文本到文件,文件不存在时,会创建文件.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="string">"add-content cmdlets will append string to a file"</span>|<span class="built_in">add-content</span> -path .\test.txt -Encoding utf8</span><br><span class="line">PS C:\Users\SPPS&gt; notepad .\test.txt</span><br></pre></td></tr></table></figure>

<p>注意add-content可能会改变原有string的格式. 以下为官网解释:</p>
<blockquote>
<p>When you pipe an object to Add-Content, the object is converted to a string before it is added to the item.The object type determines the string format, but the format might be different than the default display of the object. To control the string format, use the formatting parameters of the sending cmdlets.</p>
</blockquote>
<h4 id="set-content"><a href="#set-content" class="headerlink" title="set-content"></a>set-content</h4><p>重写(覆盖)文本到文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="string">"set-content will overwrite the file"</span> | <span class="built_in">set-content</span> -Path .\test.txt -Encoding utf8; notepad .\test.txt</span><br></pre></td></tr></table></figure>

<h4 id="System-IO-File-WriteAllText"><a href="#System-IO-File-WriteAllText" class="headerlink" title="[System.IO.File]::WriteAllText()"></a>[System.IO.File]::WriteAllText()</h4><p>覆盖原有文件,可指定encoding</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; [System.IO.File]::WriteAllText(<span class="string">"c:\temp\test.txt"</span>,<span class="string">"[System.IO.File]::WriteAllText() will overwrite the file"</span>,[System.Text.UTF8Encoding]::UTF8)</span><br><span class="line">PS C:\Users\SPPS&gt; notepad c:\temp\test.txt</span><br></pre></td></tr></table></figure>

<h4 id="System-IO-File-WriteAllLines"><a href="#System-IO-File-WriteAllLines" class="headerlink" title="[System.IO.File]::WriteAllLines()"></a>[System.IO.File]::WriteAllLines()</h4><p>写入一个数组/集合,每个数组/集合元素一行,覆盖原有文件,可指定encoding</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; [System.IO.File]::WriteAllLines(<span class="string">"c:\temp\test.txt"</span>,<span class="number">1</span>..<span class="number">5</span>,[System.Text.UTF8Encoding]::UTF8)</span><br><span class="line">PS C:\Users\SPPS&gt; notepad c:\temp\test.txt</span><br></pre></td></tr></table></figure>

<h4 id="System-IO-File-WriteAllBytes"><a href="#System-IO-File-WriteAllBytes" class="headerlink" title="[System.IO.File]::WriteAllBytes()"></a>[System.IO.File]::WriteAllBytes()</h4><p>字节写入,针对图片之类的,覆盖原有文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="variable">$file</span> = [System.IO.File]::ReadAllBytes(<span class="string">'c:\temp\test.jpg'</span>)</span><br><span class="line">PS C:\Users\SPPS&gt; [System.IO.File]::WriteAllBytes(<span class="string">'c:\temp\test2.jpg'</span>,<span class="variable">$file</span>)</span><br></pre></td></tr></table></figure>

<p>下面3个是上面.NET write方法对应的append方法,一样用法,只不过他们是添加到文件,而不是覆盖.</p>
<ul>
<li>[System.IO.File]::AppendAllLines()</li>
<li>[System.IO.File]::AppendAllText()</li>
<li>[System.IO.File]::AppendText()</li>
</ul>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><h4 id="文件锁"><a href="#文件锁" class="headerlink" title="文件锁"></a>文件锁</h4><p>写的同时,别的程序或者命令不能访问这个文件</p>
<p>Out-File不会锁文件<br>Set-Content会锁住文件<br>.NET方法我没测,但是我查了下,应该都是有锁的<br>所以针对需要长时间操作的IO，不建议用Set-Content和.NET方法。</p>
<blockquote>
<p>WriteAllText method acquires an Exclusive Lock from the file system before it starts writing and releases it when it’s finished</p>
</blockquote>
<h4 id="Encoding"><a href="#Encoding" class="headerlink" title="Encoding"></a>Encoding</h4><p>Out-File默认Unicode (UTF-16LE)<br>Set-Content默认ASCII (US-ASCII) in PowerShell 3+</p>
<p>Set-Content支持-Encoding Byte而Out-File却不支持,所以上面[System.IO.File]::WriteAllBytes()示例可用下面方法改写.<br>注意set-content接收的数据也要是byte,所以get-content 我们也用了-Encoding Byte参数.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="built_in">get-content</span> <span class="string">'.\test.jpg'</span> -Encoding Byte|<span class="built_in">set-content</span> <span class="string">'.\test2.jpg'</span> -Encoding Byte</span><br></pre></td></tr></table></figure>


<h4 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h4><p>Out-File会原样的保持console里面的输出样式到文件中. 所以如果一个文件夹中有2 个file,(dir) | out-file out.txt会使out.txt有11行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PS D:\SPPS1&gt; dir C:\temp\testfolder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: C:\temp\testfolder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name                                                                                             </span><br><span class="line">----                -------------         ------ ----                                                                                             </span><br><span class="line">-a----        <span class="number">8</span>/<span class="number">25</span>/<span class="number">2019</span>   <span class="number">5</span>:<span class="number">06</span> PM              <span class="number">8</span> file1.txt                                                                                        </span><br><span class="line">-a----        <span class="number">8</span>/<span class="number">25</span>/<span class="number">2019</span>   <span class="number">5</span>:<span class="number">06</span> PM              <span class="number">8</span> file2.txt                                                                                        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\SPPS1&gt; dir C:\temp\testfolder | <span class="built_in">out-file</span> d:\temp\out.txt</span><br><span class="line"></span><br><span class="line">PS D:\SPPS1&gt; ii d:\temp\out.txt <span class="comment"># there will be 11 lines in this file</span></span><br></pre></td></tr></table></figure>

<p>而(dir) | set-content out.txt只会将这2 个file的name写入out.txt,因此只有2行.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\SPPS1&gt; dir C:\temp\testfolder | <span class="built_in">set-content</span> d:\temp\out.txt</span><br><span class="line">PS D:\SPPS1&gt; ii d:\temp\out.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Set-Content is designed for string processing. If you pipe non-string objects to Set-Content, it converts the object to a string before writing it. To write objects to files, use Out-File.</p>
</blockquote>
<h4 id="文件不存在时创建文件"><a href="#文件不存在时创建文件" class="headerlink" title="文件不存在时创建文件"></a>文件不存在时创建文件</h4><p>Set-Content在有时候是不会创建文件的,比如管道接受的是一个null value就不会创建文件,而out-file则会创建一个空文件,如下所示(C:\temp\testfolder是一个空文件夹).</p>
<center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6c1pyhlg6j30fg06fq34.jpg"><br><div>22-Set-Content Not Create File</div></center>

<h4 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h4><p>Out-File和set-content都可以批量写入文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"file1.txt"</span>,<span class="string">"file2.txt"</span>| %&#123;<span class="built_in">set-content</span> -path <span class="string">"C:\temp\testfolder\<span class="variable">$_</span>"</span> -value <span class="string">"set-content to bulk files at once"</span>&#125;</span><br><span class="line"><span class="string">"file1.txt"</span>,<span class="string">"file2.txt"</span>| %&#123;<span class="built_in">out-file</span> <span class="string">"C:\temp\testfolder\<span class="variable">$_</span>"</span> -InputObject <span class="string">"set-content to bulk files at once"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要对一个文件进行批量写入,则使用Out-File <code>-append</code>参数</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"string1"</span>,<span class="string">"string2"</span>| %&#123;<span class="built_in">Out-File</span> -filepath <span class="string">"C:\temp\testfolder\file3.txt"</span> -InputObject <span class="variable">$_</span> -append&#125;</span><br></pre></td></tr></table></figure>

<p>综上,个人推荐平时优先使用out-file,下面是我平时用的一个写log的函数,供大家参考下。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Function</span> <span class="built_in">Write-Log</span>()&#123;</span><br><span class="line">    [CmdletBinding()]param(</span><br><span class="line">        [Parameter(Mandatory=<span class="literal">$true</span>)]</span><br><span class="line">        [ValidateSet(<span class="string">"Warning"</span>, <span class="string">"Error"</span>, <span class="string">"Success"</span>,<span class="string">"Normal"</span>,<span class="string">"Critical"</span>)]</span><br><span class="line">        [string]<span class="variable">$log_type</span>,</span><br><span class="line">        [string]<span class="variable">$log_info</span>,</span><br><span class="line">        [string]<span class="variable">$log_file</span>=<span class="string">"<span class="variable">$home</span>\Documents\WindowsPowerShell\log.txt"</span>,</span><br><span class="line">        [Parameter(Mandatory=<span class="literal">$false</span>)]</span><br><span class="line">        [switch]<span class="variable">$print_to_console</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">If</span>( <span class="variable">$print_to_console</span> )&#123; <span class="comment"># print the log info to the console</span></span><br><span class="line">        <span class="variable">$color</span> = <span class="keyword">switch</span> -regex (<span class="variable">$log_type</span>)&#123;</span><br><span class="line">            <span class="string">"Warning"</span>        &#123;<span class="string">'yellow'</span>;<span class="keyword">break</span>&#125;</span><br><span class="line">            <span class="string">"Success"</span>        &#123;<span class="string">'green'</span> ;<span class="keyword">break</span>&#125;</span><br><span class="line">            <span class="string">"Error|Critical"</span> &#123;<span class="string">'red'</span>   ;<span class="keyword">break</span>&#125;</span><br><span class="line">            default          &#123;<span class="string">'white'</span>       &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">write-host</span> -fore <span class="variable">$color</span> <span class="variable">$log_info</span></span><br><span class="line">    &#125; <span class="variable">$loop_cnt</span>=<span class="number">0</span></span><br><span class="line">    <span class="keyword">Do</span>&#123;</span><br><span class="line">        <span class="keyword">Try</span>&#123;<span class="string">"&#123;0:yyyy-MM-dd HH:mm:ss.fff&#125;--&#123;1&#125;: &#123;2&#125;"</span> -f (<span class="built_in">get-date</span>),<span class="variable">$log_type</span>,<span class="variable">$log_info</span> |<span class="built_in">Out-File</span> -FilePath <span class="variable">$log_file</span> -Append -Encoding utf8 -Force -ea <span class="number">1</span>;<span class="keyword">break</span>&#125;Catch&#123;sleep -Milliseconds <span class="number">200</span> ;<span class="keyword">if</span>(++<span class="variable">$loop_cnt</span> <span class="nomarkup">-gt</span> <span class="number">10</span>)&#123;<span class="built_in">write-error</span> <span class="string">"wait too long(2s) to write log: <span class="variable">$_</span>"</span>;<span class="keyword">break</span>&#125;</span><br><span class="line">        &#125;<span class="keyword">Finally</span>&#123;&#125;</span><br><span class="line">    &#125;<span class="keyword">While</span>(<span class="variable">$loop_cnt</span> <span class="nomarkup">-lt</span> <span class="number">10</span>)</span><br><span class="line">&#125;</span><br><span class="line">PS&gt;<span class="built_in">write-log</span> ERROR <span class="string">"The user cannot be found in system"</span> c:\temp\test.log</span><br><span class="line">PS&gt;cat c:\temp\test.log</span><br><span class="line"><span class="number">2018</span>-<span class="number">04</span>-<span class="number">26</span> <span class="number">18</span>:<span class="number">04</span>:<span class="number">52.225</span>--ERROR: The user cannot be found <span class="keyword">in</span> system</span><br><span class="line">PS&gt;</span><br></pre></td></tr></table></figure>

<p>参考链接，大家自己多动手，感受不同命令带来的不同结果:</p>
<blockquote>
<p><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/out-file?view=powershell-6" target="_blank" rel="noopener">Out-File</a><br><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/add-content?view=powershell-6#notes" target="_blank" rel="noopener">Add-Content</a><br><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/set-content?view=powershell-5.1" target="_blank" rel="noopener">Set-Content</a><br><a href="https://msdn.microsoft.com/en-us/library/system.io.file(v=vs.110).aspx#Methods" target="_blank" rel="noopener">File Class</a><br><a href="https://msdn.microsoft.com/en-us/library/system.text.encoding(v=vs.110).aspx" target="_blank" rel="noopener">File.ReadLines Method</a><br><a href="https://stackoverflow.com/questions/10655788/powershell-set-content-and-out-file-what-is-the-difference" target="_blank" rel="noopener">PowerShell Set-Content and Out-File - what is the difference?</a></p>
</blockquote>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">超速蜗牛</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://chaoyuew.gitee.io/WPS-22-Advanced-IO-Write.html">https://chaoyuew.gitee.io/WPS-22-Advanced-IO-Write.html</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chaoyuew.gitee.io">超速蜗牛的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-23-Advanced-IO-CSV-Manage.html"><i class="fas fa-angle-left">&nbsp;</i><span>Windows PowerShell进阶(23) IO操作之CSV</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-21-Advanced-IO-Read.html"><span>Windows PowerShell进阶(21) IO操作之读取</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 By 超速蜗牛</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>