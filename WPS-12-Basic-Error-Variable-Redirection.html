<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Windows PowerShell入门(12) 错误相关系统变量，重定向"><meta name="keywords" content="入门,error,redirection"><meta name="author" content="超速蜗牛,undefined"><meta name="copyright" content="超速蜗牛"><title>Windows PowerShell入门(12) 错误相关系统变量，重定向【超速蜗牛的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"AOHMI93W80","apiKey":"3f74c7e8113768c69c3eedfd6540618f","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#error"><span class="toc-number">1.</span> <span class="toc-text">$error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LASTEXITCODE"><span class="toc-number">2.</span> <span class="toc-text">$LASTEXITCODE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ErrorActionPreference"><span class="toc-number">3.</span> <span class="toc-text">$ErrorActionPreference</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向-gt"><span class="toc-number">4.</span> <span class="toc-text">重定向 &gt;</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">超速蜗牛</div><div class="author-info-description">Learn PowerShell.</div><div class="links-buttons"><a class="links-button button-hover" href="https://gitee.com/chaoyuew" target="_blank">Gitee<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="mailto:348001390@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="tencent://message/?uin=348001390&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color9"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">30</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">37</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">超速蜗牛的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Windows PowerShell入门(12) 错误相关系统变量，重定向</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-08-17 | 更新于 2019-08-18</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/powershell/">powershell</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/入门/">入门</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/error/">error</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/redirection/">redirection</a></div></div></div><div class="main-content"><p>本文首发于本人公众号SPPS178,现搬运过来,较原文有所改动.</p>
<p>在讲异常处理之前,有必要讲下几个相关<strong>系统变量</strong>和一个概念:<strong>重定向</strong>,这个在之前的文章里没提到,就为了专门放在这篇里讲解.</p>
<h3 id="error"><a href="#error" class="headerlink" title="$error"></a>$error</h3><p>powershell运行过程中发生的任何错误都会保存在这个变量中,需要注意的一点是,这是一个数组类型变量,其逆序排列,也就是$error[0]一直是最新的那个error,而$error[-1]一直是最早发生的那个error,示例如下:</p>
<a id="more"></a>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; <span class="variable">$Error</span>.Clear() <span class="comment"># clear all the erros</span></span><br><span class="line"><span class="keyword">try</span>&#123;<span class="number">1</span>/<span class="number">0</span>&#125;catch&#123;&#125; <span class="comment"># the old error</span></span><br><span class="line"><span class="keyword">try</span>&#123;ps aa -ea <span class="number">1</span>&#125;catch&#123;&#125; <span class="comment"># the new error</span></span><br><span class="line"><span class="variable">$Error</span>[<span class="number">0</span>] <span class="comment"># output the new error detail, in this case for "ps aa" error</span></span><br><span class="line"><span class="variable">$Error</span>[-<span class="number">1</span>] <span class="comment"># output the old error detail, in this case for "1/0" error</span></span><br><span class="line">ps : 找不到名为“aa”的进程。请验证该进程名称，然后再次调用 cmdlet。</span><br><span class="line">所在位置 行:<span class="number">3</span> 字符: <span class="number">5</span></span><br><span class="line">+ <span class="keyword">try</span>&#123;ps aa -ea <span class="number">1</span>&#125;catch&#123;&#125; <span class="comment"># the new error</span></span><br><span class="line">+     ~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (aa:String) [Get-Process], ProcessCommandException</span><br><span class="line">    + FullyQualifiedErrorId : NoProcessFoundForGivenName,Microsoft.PowerShell.Commands.GetProcessCommand</span><br><span class="line"> </span><br><span class="line">尝试除以零。</span><br><span class="line">所在位置 行:<span class="number">2</span> 字符: <span class="number">5</span></span><br><span class="line">+ <span class="keyword">try</span>&#123;<span class="number">1</span>/<span class="number">0</span>&#125;catch&#123;&#125; <span class="comment"># the old error</span></span><br><span class="line">+     ~~~</span><br><span class="line">    + CategoryInfo          : NotSpecified: (:) [], RuntimeException</span><br><span class="line">    + FullyQualifiedErrorId : RuntimeException</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">PS&gt;</span><br></pre></td></tr></table></figure>

<p>直接用index遍历$error数组返回的并不是string,如果我们希望获取string类型的error,方便后续使用可用如下方法.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$Error</span>[<span class="number">0</span>]|gm <span class="comment"># 可以试下 返回的类型是 TypeName: System.Management.Automation.ErrorRecord</span></span><br><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$Error</span>[<span class="number">1</span>].tostring() <span class="comment"># 调用方法</span></span><br><span class="line">Attempted to divide by zero.</span><br><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$Error</span>[<span class="number">1</span>].Exception.Message <span class="comment"># 调用属性</span></span><br><span class="line">Attempted to divide by zero.</span><br><span class="line"><span class="comment"># 实际工作中可能应用的一个场景,这是为了教学写的一个例子,后面有更好的error handle 方法</span></span><br><span class="line"><span class="variable">$cnt</span>=<span class="number">0</span></span><br><span class="line"><span class="variable">$Error</span>.Clear() <span class="comment"># clear all the erros</span></span><br><span class="line"><span class="variable">$rst</span> = <span class="number">100</span>/<span class="variable">$cnt</span> <span class="comment"># try to divide 100 by a variable</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$Error</span>[<span class="number">0</span>].Exception.Message -imatch <span class="string">"divide by zero"</span>)&#123;</span><br><span class="line">    <span class="comment"># we found the specific error, do the error handle thing, like save error to the log file</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LASTEXITCODE"><a href="#LASTEXITCODE" class="headerlink" title="$LASTEXITCODE"></a>$LASTEXITCODE</h3><p>这个变量储存的是上一个基于Windows的程序退出(exit)结果,返回的是int数值,一般来说0是成功,非0都是不成功. 这个和之前说的$?有点类似,但是还是有区别的. 但是,注意但是,因为退出结果是可以人为设置的. </p>
<p>这里我引用下这个这篇<a href="https://stackoverflow.com/questions/10666035/difference-between-and-lastexitcode-in-powershell" target="_blank" rel="noopener">Difference between $? and $LastExitCode in PowerShell</a>上问题的答案：</p>
<blockquote>
<p>$?  Contains the execution status of the last operation. It contains TRUE if the last operation succeeded and FALSE if it failed.<br>$LastExitCode Contains the exit code of the last Windows-based program that was run.</p>
</blockquote>
<p>然后用里面高票回答来解释下:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  cmd /c <span class="string">"exit 5"</span> <span class="comment"># 调用外部命令,人为设置exit返回值为5(非0),但是本身这个命令是执行成功了的, 没有报错的</span></span><br><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$LASTEXITCODE</span> <span class="comment"># 值为5,上一个命令的返回值</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">PS C:\Users\SPPS&gt;  $? <span class="comment"># 结果为 False ,因为 $LASTEXITCODE = 5</span></span><br><span class="line">False</span><br><span class="line">PS C:\Users\SPPS&gt;  cmd /c <span class="string">"exit 0"</span> <span class="comment"># 人为设置exit返回值为0,也就是exit默认返回值</span></span><br><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$LASTEXITCODE</span> <span class="comment"># 值为0,上一个命令的返回值</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">PS C:\Users\SPPS&gt;  $? <span class="comment"># 结果为 True ,因为 $LASTEXITCODE = 0</span></span><br><span class="line">True</span><br><span class="line">PS C:\Users\SPPS&gt;</span><br></pre></td></tr></table></figure>

<p>所以对于调用一些个人开发的程序,最好能确定其退出返回值是否人为设置了,否则不推荐用这个变量来判断成功与否,但是对于一般的微软自带的命令还是可以用的,这个接下来结合重定向讲比较好理解.</p>
<h3 id="ErrorActionPreference"><a href="#ErrorActionPreference" class="headerlink" title="$ErrorActionPreference"></a>$ErrorActionPreference</h3><p>这个变量存储的是powershell运行中接下来有错误出现时,应该执行什么动作,valid的值如下(只能取这几个值).</p>
<ul>
<li>$ErrorActionPreference = ‘SilentlyContinue’ # 继续接下来的命令,不会把错误打印到屏幕,但是会被$error记录下来. 注意SilentlyContinue中间没有空格</li>
<li>$ErrorActionPreference = ‘Stop’             # 把错误打印到屏幕,停止当前,会被$error记录下来</li>
<li>$ErrorActionPreference = ‘Continue’         # 会被$error记录下来</li>
<li>$ErrorActionPreference = ‘Inquire’          # 询问用户是否继续,等待永辉反馈,会被$error记录下来</li>
<li>$ErrorActionPreference = ‘Ignore’           # 继续接下来的命令,不会把错误打印到屏幕,不会被$error记录下来</li>
<li>$ErrorActionPreference =’Suspend’           # 只能用在workflow当中,这个以后再说,平时基本用不到,有兴趣可以自己微软官网了解</li>
</ul>
<p>可以用简写的数字代替,效果一样</p>
<ul>
<li>$ErrorActionPreference = 0 # is SilentlyContinue</li>
<li>$ErrorActionPreference = 1 # is Stop</li>
<li>$ErrorActionPreference = 2 # is Continue</li>
<li>$ErrorActionPreference = 3 # is Inquire</li>
<li>$ErrorActionPreference = 4 # is Ignore</li>
<li>$ErrorActionPreference = 5 # is Suspend, 只能用在workflow当中</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$ErrorActionPreference</span> = <span class="string">'SilentlyContinue'</span> </span><br><span class="line">ps aa ; <span class="built_in">get-date</span> ; <span class="variable">$error</span>[<span class="number">0</span>] <span class="comment"># get-date 会被执行,即使上一条是会产生错误的命令</span></span><br><span class="line"></span><br><span class="line">Thursday, March <span class="number">22</span>, <span class="number">2018</span> <span class="number">7</span>:<span class="number">53</span>:<span class="number">14</span> PM</span><br><span class="line">ps : Cannot find a <span class="keyword">process</span> with the name <span class="string">"aa"</span>. Verify the <span class="keyword">process</span> name and call the cmdlet again.</span><br><span class="line">At line:<span class="number">2</span> char:<span class="number">1</span></span><br><span class="line">+ ps aa ; <span class="built_in">get-date</span> ; <span class="variable">$error</span>[<span class="number">0</span>]</span><br><span class="line">+ ~~~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (aa:String) [Get-Process], ProcessCommandException</span><br><span class="line">    + FullyQualifiedErrorId : NoProcessFoundForGivenName,Microsoft.PowerShell.Commands.GetProcessCommand</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS&gt;  <span class="variable">$ErrorActionPreference</span> = <span class="string">'Stop'</span> </span><br><span class="line">ps bb ; <span class="built_in">get-date</span>  <span class="comment"># get-date 不会被执行</span></span><br><span class="line"></span><br><span class="line">ps : Cannot find a <span class="keyword">process</span> with the name <span class="string">"bb"</span>. Verify the <span class="keyword">process</span> name and call the cmdlet again.</span><br><span class="line">At line:<span class="number">2</span> char:<span class="number">1</span></span><br><span class="line">+ ps bb ; <span class="built_in">get-date</span> ; <span class="variable">$error</span>[<span class="number">0</span>]</span><br><span class="line">+ ~~~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (bb:String) [Get-Process], ProcessCommandException</span><br><span class="line">    + FullyQualifiedErrorId : NoProcessFoundForGivenName,Microsoft.PowerShell.Commands.GetProcessCommand</span><br></pre></td></tr></table></figure>

<p>其余的命令大家自己试下,当你改变了$ErrorActionPreference之后,在你再次改变它之前,后面遇到的任何错误命令都会用前面specify的action来处理.</p>
<p>如果我只想针对某条命令使用specified的ErrorAction,而不想更改整体的powershell的全局$ErrorActionPreference的值,那么就可以用参数的形式来自定义:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  ps aa -ErrorAction SilentlyContinue</span><br></pre></td></tr></table></figure>

<p>这里的<code>-ErrorAction</code>是叫做通用参数(<code>CommonParameters</code>)的一个参数,也就是很多命令都可以使用它,随便查看一个命令如下,可以看到他的SYNTAX有[<commonparameters>] (最后一个),那就是可以用-ErrorAction的,一般的通用参数还有-force(比如强制写文件) ,-Verbose(输出详细调试信息)等等,这个不用记,遇到再讲.</commonparameters></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  ps -? </span><br><span class="line">NAME</span><br><span class="line">    <span class="built_in">Get-Process</span></span><br><span class="line">SYNTAX</span><br><span class="line">    <span class="built_in">Get-Process</span> [[-Name] &lt;string[]&gt;] [-ComputerName &lt;string[]&gt;] [-Module] [-FileVersionInfo]  [&lt;CommonParameters&gt;]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>既然$ErrorActionPreference可以用数字赋值,那么<code>-ErrorAction</code>也可以,所以ps aa -ErrorAction SilentlyContinue也可以写为ps aa -ErrorAction 0,更进一步,ErrorAction还有一个更短的alias <code>ea</code>(ErrorAction首字母缩写),所以还可以写为 ps aa -ea 0.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下4种写法效果一样</span></span><br><span class="line">ps aa -ErrorAction SilentlyContinue</span><br><span class="line">ps aa -ErrorAction <span class="number">0</span></span><br><span class="line">ps aa -ea SilentlyContinue</span><br><span class="line">ps aa -ea <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="重定向-gt"><a href="#重定向-gt" class="headerlink" title="重定向 &gt;"></a>重定向 &gt;</h3><p>上面说的$ErrorActionPreference和-ErrorAction都是针对powershell的自身命令使用的,但是有时候需要调用外部程序,这些参数可能就没法使用了,如下所示:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  cmd /c <span class="string">"aaa"</span> -ea <span class="number">0</span></span><br><span class="line">cmd : <span class="string">'aaa'</span> is not recognized as an internal or external command,</span><br><span class="line">At line:<span class="number">2</span> char:<span class="number">1</span></span><br><span class="line">+ cmd /c <span class="string">"aaa"</span> -ea <span class="number">0</span></span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : NotSpecified: (<span class="string">'aaa'</span> is not re...ternal command,:String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">operable program or batch file.</span><br><span class="line">PS C:\Users\SPPS&gt;</span><br></pre></td></tr></table></figure>

<p>这时候就可以用重定向来处理信息流的处理,有过shell编程经验的应该对这个熟悉。其用相应的数字代表信息流：</p>
<blockquote>
<p>The PowerShell redirection operators use the following characters to represent each output type:</p>
</blockquote>
<ul>
<li>*   All output        # 所有输出</li>
<li>1   Success output    # 运行成功输出</li>
<li>2   Errors            # 错误输出</li>
<li>3   Warning messages  # 警告信息</li>
<li>4   Verbose output    # 详细输出</li>
<li>5   Debug messages    # 调试信息</li>
</ul>
<p>重定向一般是用来将本该输出到屏幕的标准输出STD IN/OUT 写到文件中区,对应error处理这块,如果我们不是写到文件里而是写到null里,那么就可以是错误信息不再输出到屏幕上</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt;  cmd /c <span class="string">"aaa"</span> <span class="number">2</span>&gt;<span class="literal">$null</span> <span class="comment"># 将错误重定向输出到null,即不打印到屏幕,但是注意这个错误信息却依旧会被$error记录下来</span></span><br><span class="line">PS C:\Users\SPPS&gt;  cmd /c <span class="string">"aaa"</span> <span class="number">1</span>&gt;<span class="literal">$null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> <span class="comment"># 将错误信息流导入到成功的信息流中,而同时也将成功信息重定向到null,所以这条命令的意义是无论成功还是出错,都不要打印信息到屏幕</span></span><br></pre></td></tr></table></figure>

<p>所以可以用下面方法而不是检测<code>$LASTEXITCODE</code>来判断上一条命令执行是否成功。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="variable">$Error</span>.Clear() <span class="comment"># 清除现有的error</span></span><br><span class="line">cmd /c <span class="string">"exit 5"</span> <span class="number">1</span>&gt;<span class="literal">$null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> <span class="nomarkup">-eq</span> <span class="variable">$Error</span>.Count)&#123; <span class="comment"># 执行上条命令后$Error数组的个数没有增加，还为0</span></span><br><span class="line">    <span class="built_in">write-host</span> <span class="string">'last command--&gt; cmd /c "exit 5" executed successfully'</span></span><br><span class="line">&#125;</span><br><span class="line">last command--&gt; cmd /c <span class="string">"exit 5"</span> executed successfully</span><br><span class="line">PS C:\Users\SPPS&gt;</span><br></pre></td></tr></table></figure>

<p>详细使用见微软官网<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_redirection?view=powershell-6" target="_blank" rel="noopener">About Redirection</a></p>
<p>powershell还有一个自带的命令Out-Null,但是它只是将正常输出结果sends to NULL,错误信息还是会被打印出来.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; <span class="built_in">get-date</span>|<span class="built_in">out-null</span></span><br><span class="line"></span><br><span class="line">PS&gt; get-dat|<span class="built_in">out-null</span></span><br><span class="line">get-dat : 无法将“get-dat”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。</span><br><span class="line">所在位置 行:<span class="number">1</span> 字符: <span class="number">1</span></span><br><span class="line">+ get-dat|<span class="built_in">out-null</span></span><br><span class="line">+ ~~~~~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (get-dat:String) [], CommandNotFoundException</span><br><span class="line">    + FullyQualifiedErrorId : CommandNotFoundException</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">PS&gt;</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">超速蜗牛</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://chaoyuew.gitee.io/WPS-12-Basic-Error-Variable-Redirection.html">https://chaoyuew.gitee.io/WPS-12-Basic-Error-Variable-Redirection.html</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chaoyuew.gitee.io">超速蜗牛的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-13-Basic-Error-Handling.html"><i class="fas fa-angle-left">&nbsp;</i><span>Windows PowerShell入门(13) 异常处理try-catch-finally</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-11-Basic-HashTable.html"><span>Windows PowerShell入门(11) 哈希表-hashtable</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 By 超速蜗牛</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>