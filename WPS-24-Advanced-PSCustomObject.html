<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Windows PowerShell进阶(24) PSCustomObject"><meta name="keywords" content="进阶,PSCustomObject,Hashtable"><meta name="author" content="超速蜗牛,undefined"><meta name="copyright" content="超速蜗牛"><title>Windows PowerShell进阶(24) PSCustomObject【超速蜗牛的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"AOHMI93W80","apiKey":"3f74c7e8113768c69c3eedfd6540618f","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建PSCustomObject"><span class="toc-number">1.</span> <span class="toc-text">创建PSCustomObject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#转化哈希表"><span class="toc-number">1.1.</span> <span class="toc-text">转化哈希表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传统方法"><span class="toc-number">1.2.</span> <span class="toc-text">传统方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#保存到文件"><span class="toc-number">2.</span> <span class="toc-text">保存到文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加属性"><span class="toc-number">3.</span> <span class="toc-text">添加属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#移除属性"><span class="toc-number">4.</span> <span class="toc-text">移除属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#枚举属性名称"><span class="toc-number">5.</span> <span class="toc-text">枚举属性名称</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#动态访问属性"><span class="toc-number">5.1.</span> <span class="toc-text">动态访问属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#将pscustomboject转换为hashtable"><span class="toc-number">5.1.1.</span> <span class="toc-text">将pscustomboject转换为hashtable</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试属性"><span class="toc-number">6.</span> <span class="toc-text">测试属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加对象方法"><span class="toc-number">7.</span> <span class="toc-text">添加对象方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象与值类型"><span class="toc-number">8.</span> <span class="toc-text">对象与值类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#psobject-copy"><span class="toc-number">8.1.</span> <span class="toc-text">psobject.copy()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义对象类型的PSTypeName（类型名称）"><span class="toc-number">9.</span> <span class="toc-text">自定义对象类型的PSTypeName（类型名称）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用DefaultPropertySet（较长的命令方法）"><span class="toc-number">10.</span> <span class="toc-text">使用DefaultPropertySet（较长的命令方法）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Update-TypeData-with-DefaultPropertySet"><span class="toc-number">10.1.</span> <span class="toc-text">Update-TypeData with DefaultPropertySet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Update-TypeData-with-ScriptProperty"><span class="toc-number">10.2.</span> <span class="toc-text">Update-TypeData with ScriptProperty</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数参数"><span class="toc-number">11.</span> <span class="toc-text">函数参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数输出"><span class="toc-number">12.</span> <span class="toc-text">函数输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最后的想法"><span class="toc-number">13.</span> <span class="toc-text">最后的想法</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">超速蜗牛</div><div class="author-info-description">Learn PowerShell.</div><div class="links-buttons"><a class="links-button button-hover" href="https://gitee.com/chaoyuew" target="_blank">Gitee<i class="icon-dot bg-color1"></i></a><a class="links-button button-hover" href="mailto:348001390@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color7"></i></a><a class="links-button button-hover" href="tencent://message/?uin=348001390&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color2"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">26</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">34</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">超速蜗牛的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Windows PowerShell进阶(24) PSCustomObject</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-08-25 | 更新于 2019-08-25</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/powershell/">powershell</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/进阶/">进阶</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/PSCustomObject/">PSCustomObject</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Hashtable/">Hashtable</a></div></div></div><div class="main-content"><p>本文首发于本人公众号SPPS178,现搬运过来,较原文有所改动.</p>
<p><a href="https://powershellexplained.com/2016-10-28-powershell-everything-you-wanted-to-know-about-pscustomobject/" target="_blank" rel="noopener">Powershell: Everything you wanted to know about PSCustomObject</a>这是我目前看到的介绍powershell自定义对象最全面的一篇文章，所以搬运过来给大家参看下， 英文没问题的直接看原文。主要针对上一篇的<a href="https://chaoyuew.gitee.io/WPS-23-Advanced-IO-CSV-Manage.html">Windows PowerShell进阶(23) IO操作之CSV</a>引入和深化。</p>
<a id="more"></a>

<h3 id="创建PSCustomObject"><a href="#创建PSCustomObject" class="headerlink" title="创建PSCustomObject"></a>创建PSCustomObject</h3><p>我喜欢在Powershell中使用[PSCustomObject]。 创建一个可用的对象从未如此简单。 因此，我会跳过所有其他你可能使用的方式创建一个对象，<strong>但我需要指出的此文大部分是Powershell v3.0和更新的版本才有的特性。</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span> = [PSCustomObject]@&#123;</span><br><span class="line">    Name     = <span class="string">'Kevin'</span></span><br><span class="line">    Language = <span class="string">'Powershell'</span></span><br><span class="line">    State    = <span class="string">'Texas'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这对我来说很好，因为我使用哈希表来处理所有事情。 但有时候我会希望Powershell能像对待对象一样处理哈希表而PSCustomObject就可以做到。 您首先注意到不同之处在于，当您想要使用Format-Table或Export-CSV时，您意识到哈希表只是键/值对的集合。（这个我们上一篇已经提到过了）</p>
<p>然后，您可以像访问普通对象一样访问和使用这些值。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span>.Name</span><br></pre></td></tr></table></figure>

<h4 id="转化哈希表"><a href="#转化哈希表" class="headerlink" title="转化哈希表"></a>转化哈希表</h4><p>当我谈论这个话题时，你是否知道你可以这样做：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="variable">$myHashtable</span> = @&#123;</span><br><span class="line">    Name     = <span class="string">'Kevin'</span></span><br><span class="line">    Language = <span class="string">'Powershell'</span></span><br><span class="line">    State    = <span class="string">'Texas'</span></span><br><span class="line">    a=<span class="number">1</span></span><br><span class="line">    b=<span class="number">2</span></span><br><span class="line">    c=<span class="number">3</span></span><br><span class="line">    d=<span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$my_transfer_object</span> = [pscustomobject]<span class="variable">$myHashtable</span></span><br><span class="line"><span class="variable">$my_transfer_object</span> <span class="comment"># 属性顺序是随机打乱的</span></span><br><span class="line">Name     : Kevin</span><br><span class="line">a        : <span class="number">1</span></span><br><span class="line">Language : Powershell</span><br><span class="line">d        : <span class="number">4</span></span><br><span class="line">b        : <span class="number">2</span></span><br><span class="line">State    : Texas</span><br><span class="line">c        : <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>我更喜欢从一开始就创建对象，但有时候你必须首先使用哈希表。 上面代码能够工作是因为构造器为对象属性提供了一个hastable。 一个重要的注意事项是虽然这有效，但它不是完全相同的（指与上个例子中的$myObject）。最大的区别是属性的顺序不被保留。</p>
<h4 id="传统方法"><a href="#传统方法" class="headerlink" title="传统方法"></a>传统方法</h4><p>您可能已经看到有人使用New-Object来创建自定义对象。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myHashtable</span> = @&#123;</span><br><span class="line">    Name     = <span class="string">'Kevin'</span></span><br><span class="line">    Language = <span class="string">'Powershell'</span></span><br><span class="line">    State    = <span class="string">'Texas'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$myObject</span> = <span class="built_in">New-Object</span> -TypeName PSObject -Property <span class="variable">$myHashtable</span></span><br></pre></td></tr></table></figure>

<p>这种方式比较慢，但它可能是PowerShell早期版本的最佳选择。</p>
<blockquote>
<p>(编者注：[pscustomobject]是从powershell V3.0之后引入的，早期版本只能用New-Object来达到此效果，具体使用和区别见：<a href="https://blogs.technet.microsoft.com/heyscriptingguy/2013/11/07/a-powershell-object-lesson-part-3/" target="_blank" rel="noopener">A PowerShell Object Lesson: Part 3</a>)</p>
</blockquote>
<h3 id="保存到文件"><a href="#保存到文件" class="headerlink" title="保存到文件"></a>保存到文件</h3><p>我发现将一个哈希表保存为一个文件的最好方法是将其另存为JSON。 您可以将其导回到[PSCusomObject]。我在文章中介绍了更多将对象保存到文件的方法：<a href="https://kevinmarquette.github.io/2017-03-18-Powershell-reading-and-saving-data-to-files/?utm_source=blog&utm_medium=blog&utm_content=pscustomobject" target="_blank" rel="noopener">Powershell: The many ways to read and write to files</a>(这篇文章可以和前面的21,22篇结合起来看)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span> | <span class="built_in">ConvertTo-Json</span> | <span class="built_in">Set-Content</span> -Path <span class="variable">$Path</span></span><br><span class="line"><span class="variable">$myObject1</span> = <span class="built_in">Get-Content</span> -Path <span class="variable">$Path</span> | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line"><span class="variable">$myObject1</span>.GetType()</span><br><span class="line">IsPublic IsSerial Name                                     BaseType</span><br><span class="line">-------- -------- ----                                     --------</span><br><span class="line">True     False    PSCustomObject                           System.Object</span><br></pre></td></tr></table></figure>

<blockquote>
<p>（编者注：这个大家自己根据实际情况决定，我一般还是喜欢保存为csv格式的）</p>
</blockquote>
<h3 id="添加属性"><a href="#添加属性" class="headerlink" title="添加属性"></a>添加属性</h3><p>您仍然可以使用<code>Add-Member</code>将新属性添加到<code>PSCustomObject</code>。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span> | <span class="built_in">Add-Member</span> -MemberType NoteProperty -Name <span class="string">'ID'</span> -Value <span class="string">'KevinMarquette'</span></span><br><span class="line"><span class="variable">$myObject</span>.ID</span><br></pre></td></tr></table></figure>

<h3 id="移除属性"><a href="#移除属性" class="headerlink" title="移除属性"></a>移除属性</h3><p>您也可以从对象中移除属性。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span>.psobject.properties.remove(<span class="string">'ID'</span>)</span><br></pre></td></tr></table></figure>

<p><code>psobject</code>是一个隐藏属性，可让您访问基础对象元数据。(编者注：这个后面专门会讲)</p>
<h3 id="枚举属性名称"><a href="#枚举属性名称" class="headerlink" title="枚举属性名称"></a>枚举属性名称</h3><p>有时你需要一个对象上所有属性名称的列表。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span> | <span class="built_in">Get-Member</span> -MemberType NoteProperty | Select -ExpandProperty Name</span><br></pre></td></tr></table></figure>

<p>我们也可以从psobject属性中获得同样的列表。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myobject</span>.psobject.properties.name</span><br></pre></td></tr></table></figure>

<h4 id="动态访问属性"><a href="#动态访问属性" class="headerlink" title="动态访问属性"></a>动态访问属性</h4><p>我已经提到你直接访问属性值。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span>.Name</span><br></pre></td></tr></table></figure>

<p>您可以使用字符串作为属性名称，它仍然可以工作。（编者注：针对属性名字中含有空格或者特殊字符）</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span>.<span class="string">'Name'</span></span><br></pre></td></tr></table></figure>

<p>我们可以据此近一步使用变量作为属性名称。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$property</span> = <span class="string">'Name'</span></span><br><span class="line"><span class="variable">$myObject</span>.<span class="variable">$property</span></span><br></pre></td></tr></table></figure>

<p>我知道这看起来很奇怪，但它确实可以生效。</p>
<h5 id="将pscustomboject转换为hashtable"><a href="#将pscustomboject转换为hashtable" class="headerlink" title="将pscustomboject转换为hashtable"></a>将pscustomboject转换为hashtable</h5><p>接着上一节所说，您可以动态地遍历pscustomboject属性并从中创建一个哈希表。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$hashtable</span> = @&#123;&#125;</span><br><span class="line"><span class="keyword">foreach</span>( <span class="variable">$property</span> <span class="keyword">in</span> <span class="variable">$myobject</span>.psobject.properties.name )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$hashtable</span>[<span class="variable">$property</span>] = <span class="variable">$myObject</span>.<span class="variable">$property</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试属性"><a href="#测试属性" class="headerlink" title="测试属性"></a>测试属性</h3><p>如果你需要知道一个属性是否存在，你可以检查该属性是否为null。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="literal">$null</span> <span class="nomarkup">-ne</span> <span class="variable">$myObject</span>.ID )</span><br></pre></td></tr></table></figure>

<p>但是，如果属性值可能为$null，并且您仍然需要检查它，则可以检查psobject.properties。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="variable">$myobject</span>.psobject.properties.match(<span class="string">'ID'</span>) )</span><br></pre></td></tr></table></figure>

<h3 id="添加对象方法"><a href="#添加对象方法" class="headerlink" title="添加对象方法"></a>添加对象方法</h3><p>如果需要将脚本方法添加到对象，可以使用<code>Add-Member</code>和<code>ScriptBlock</code>来完成。 你必须使用<code>this</code>自动变量引用当前对象。 这是一个将对象转换为哈希表的脚本块。（最后5.1.1例子的代码相同）</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ScriptBlock</span> = &#123;</span><br><span class="line">    <span class="variable">$hashtable</span> = @&#123;&#125;</span><br><span class="line">    <span class="keyword">foreach</span>( <span class="variable">$property</span> <span class="keyword">in</span> <span class="variable">$this</span>.psobject.properties.name )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$hashtable</span>[<span class="variable">$property</span>] = <span class="variable">$this</span>.<span class="variable">$property</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$hashtable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们将它作为脚本属性添加到我们的对象中。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$memberParam</span> = @&#123;</span><br><span class="line">    MemberType ScriptMethod</span><br><span class="line">    InputObject <span class="variable">$myobject</span></span><br><span class="line">    Name <span class="string">"ToHashtable"</span></span><br><span class="line">    Value <span class="variable">$scriptBlock</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Add-Member</span> @memberParam</span><br></pre></td></tr></table></figure>

<p>然后我们可以像这样调用我们的函数：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span>.ToHashtable()</span><br></pre></td></tr></table></figure>

<h3 id="对象与值类型"><a href="#对象与值类型" class="headerlink" title="对象与值类型"></a>对象与值类型</h3><p>对象和值类型不以相同的方式处理变量赋值。 如果将值类型分配给彼此，则只有值被复制到新变量。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$first</span> = <span class="number">1</span></span><br><span class="line"><span class="variable">$second</span> = <span class="variable">$first</span></span><br><span class="line"><span class="variable">$second</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，<code>$first</code>是1，<code>$second</code>是2。<br>对象变量持有对实际对象的引用。 当您将一个对象分配给一个新变量时，它们仍然引用相同的对象。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$third</span> = [PSCustomObject]@&#123;Key=<span class="number">3</span>&#125;</span><br><span class="line"><span class="variable">$fourth</span> = <span class="variable">$third</span></span><br><span class="line"><span class="variable">$fourth</span>.Key = <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>因为<code>$third</code>和<code>$fourth</code>引用同一个对象实例，所以<code>$third.key</code>和<code>$fourth.Key</code>都是4。</p>
<h4 id="psobject-copy"><a href="#psobject-copy" class="headerlink" title="psobject.copy()"></a>psobject.copy()</h4><p>如果你需要一个对象的真实副本，你可以克隆它。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$third</span> = [PSCustomObject]@&#123;Key=<span class="number">3</span>&#125;</span><br><span class="line"><span class="variable">$fourth</span> = <span class="variable">$third</span>.psobject.copy()</span><br><span class="line"><span class="variable">$fourth</span>.Key = <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>克隆创建对象的浅表副本。 他们现在有不同的实例，在这个例子中<code>$third.key</code>是3，<code>$fourth.Key</code>是4。<br><strong>我称之为浅拷贝是因为如果你有嵌套的对象（这些属性包含其他对象）。只有顶级值被复制。子对象依然相互引用。</strong></p>
<blockquote>
<p>（编者注：这一节大家多留个心，后面讲多线程的时候可能会用到这个知识点）</p>
</blockquote>
<h3 id="自定义对象类型的PSTypeName（类型名称）"><a href="#自定义对象类型的PSTypeName（类型名称）" class="headerlink" title="自定义对象类型的PSTypeName（类型名称）"></a>自定义对象类型的PSTypeName（类型名称）</h3><p>现在我们有了一个对象，我们可以用它做更多的事情，这可能不是那么明显。 首先我们需要做的是给它一个<code>PSTypeName</code>。 这是我看到人们最常见的方式：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span>.PSObject.TypeNames.Insert(<span class="number">0</span>,<span class="string">"My.Object"</span>)</span><br></pre></td></tr></table></figure>

<p>我最近从<a href="https://www.reddit.com/r/PowerShell/comments/590awc/is_it_possible_to_initialize_a_pscustoobject_with/" target="_blank" rel="noopener">https://www.reddit.com/r/PowerShell/comments/590awc/is_it_possible_to_initialize_a_pscustoobject_with/</a> 这篇文章中发现了另一种方法。 我做了一点挖掘，并从<a href="http://www.adamtheautomator.com/building-custom-object-types-powershell-pstypename/" target="_blank" rel="noopener">Building Custom Object Types with PowerShell and PSTypeName</a>和<a href="https://powershellstation.com/2016/05/22/custom-objects-and-pstypename/" target="_blank" rel="noopener">Custom objects and PSTypeName</a>那里了解更多关于这个想法的帖子，他们在这里谈论了这种方法，可以让你对它进行内联定义。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span> = [PSCustomObject]@&#123;</span><br><span class="line">    PSTypeName = <span class="string">'My.Object'</span></span><br><span class="line">    Name       = <span class="string">'Kevin'</span></span><br><span class="line">    Language   = <span class="string">'Powershell'</span></span><br><span class="line">    State      = <span class="string">'Texas'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$myObject</span> |gm <span class="comment">#看输出的第一行TypeName ，是我们自定义的名字了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   TypeName:My.Object</span><br><span class="line">   </span><br><span class="line">Name        MemberType   Definition                    </span><br><span class="line">----        ----------   ----------                    </span><br><span class="line">Equals      Method       bool Equals(System.Object obj)</span><br><span class="line">GetHashCode Method       int GetHashCode()             </span><br><span class="line">GetType     Method       type GetType()                </span><br><span class="line">ToString    Method       string ToString()             </span><br><span class="line">Language    NoteProperty string Language=Powershell    </span><br><span class="line">Name        NoteProperty string Name=Kevin             </span><br><span class="line">State       NoteProperty string State=Texas</span><br></pre></td></tr></table></figure>

<p>我热爱这种恰到好处的语言使用技巧。 既然我们有一个适当类型名称的对象，我们可以做更多的事情。</p>
<h3 id="使用DefaultPropertySet（较长的命令方法）"><a href="#使用DefaultPropertySet（较长的命令方法）" class="headerlink" title="使用DefaultPropertySet（较长的命令方法）"></a>使用DefaultPropertySet（较长的命令方法）</h3><p>Powershell为我们决定默认显示哪些属性。 许多本机命令都有一个.ps1xml格式化文件，可以完成所有繁重的工作。 从Boe Prox的这篇文章中<a href="https://learn-powershell.net/2013/08/03/quick-hits-set-the-default-property-display-in-powershell-on-custom-objects/" target="_blank" rel="noopener">Quick Hits: Set the Default Property Display in PowerShell on Custom Objects</a>，我们有另一种方法可以使用Powershell在我们的自定义对象上执行此操作。 我们可以给它一个MemberSet供它使用。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$defaultDisplaySet</span> = <span class="string">'Name'</span>,<span class="string">'Language'</span></span><br><span class="line"><span class="variable">$defaultDisplayPropertySet</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSPropertySet(‘DefaultDisplayPropertySet’,[string[]]<span class="variable">$defaultDisplaySet</span>)</span><br><span class="line"><span class="variable">$PSStandardMembers</span> = [System.Management.Automation.PSMemberInfo[]]@(<span class="variable">$defaultDisplayPropertySet</span>)</span><br><span class="line"><span class="variable">$MyObject</span> | <span class="built_in">Add-Member</span> MemberSet PSStandardMembers <span class="variable">$PSStandardMembers</span></span><br></pre></td></tr></table></figure>

<p>现在，当我的对象落到了shell中时，它只会默认显示这些属性。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS&gt; <span class="variable">$MyObject</span> <span class="comment"># 只显示我们自定义的默认属性值</span></span><br><span class="line">Name  Language  </span><br><span class="line">----  --------  </span><br><span class="line">Kevin Powershell</span><br><span class="line">PS C:\Users\SPPS&gt; <span class="variable">$MyObject</span>|select * <span class="comment"># 所有属性值</span></span><br><span class="line">Name  Language   State</span><br><span class="line">----  --------   -----</span><br><span class="line">Kevin Powershell Texas</span><br></pre></td></tr></table></figure>

<h4 id="Update-TypeData-with-DefaultPropertySet"><a href="#Update-TypeData-with-DefaultPropertySet" class="headerlink" title="Update-TypeData with DefaultPropertySet"></a>Update-TypeData with DefaultPropertySet</h4><p>上面使用方法真的很不错，但是最近我看到<a href="https://www.youtube.com/watch?v=Ab46gHXNm8Q" target="_blank" rel="noopener">PowerShell unplugged 2016 with Jeffrey Snover &amp; Don Jones</a>，他使用Update-TypeData来指定默认属性。(编者注：V3.0 之后才有的cmdlets)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TypeData</span> = @&#123;</span><br><span class="line">    TypeName = <span class="string">'My.Object'</span></span><br><span class="line">    DefaultDisplayPropertySet = <span class="string">'Name'</span>,<span class="string">'Language'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Update-TypeData</span> @TypeData</span><br></pre></td></tr></table></figure>

<p>这很简单，如果我没有这篇文章作为快速参考，我几乎可以记住它。 现在我可以轻松地创建具有许多属性的对象，并且在从shell查看时仍然可以给它一个很好的清晰视图。 如果我需要访问或查看其他属性，它们仍然存在。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myObject</span> | <span class="built_in">Format-List</span> *</span><br></pre></td></tr></table></figure>

<h4 id="Update-TypeData-with-ScriptProperty"><a href="#Update-TypeData-with-ScriptProperty" class="headerlink" title="Update-TypeData with ScriptProperty"></a>Update-TypeData with ScriptProperty</h4><p>我从视频中获得的其他内容是为对象创建脚本属性。 这将是一个很好的时机，指出这也适用于已存在的对象。</p>
<p>你可以在你的对象被创建或之后做到这一点，它仍然会工作。 这使得其与<code>Add-Member</code>是2种不同的方式。 按照我之前提到的方式使用Add-Member时，它只存在于该对象的特定实例上。 这个适用于所有具有此TypeName的对象。</p>
<h3 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h3><p>您现在可以在您的函数和脚本中使用这些自定义类型的参数。 你可以有一个函数创建这些自定义对象，然后将它们传递给其他函数。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">param</span>( [PSTypeName(<span class="string">'My.Object'</span>)]<span class="variable">$Data</span> )</span><br></pre></td></tr></table></figure>

<p>然后Powershell将要求该对象是您指定的类型。 如果类型不自动匹配，它会引发验证错误，以便为您节省在代码中对其进行测试的步骤。 一个很好说明让Powershell做到最好的例子。</p>
<h3 id="函数输出"><a href="#函数输出" class="headerlink" title="函数输出"></a>函数输出</h3><p>您也可以为您的高级功能定义一个OutputType。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Get-MyObject</span><br><span class="line">&#123;</span><br><span class="line">    [OutputType(<span class="string">'My.Object'</span>)] </span><br><span class="line">    [CmdletBinding()]</span><br><span class="line">        <span class="keyword">param</span></span><br><span class="line">        (</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>

<p>OutputType<a href="https://technet.microsoft.com/en-us/library/hh847785.aspx" target="_blank" rel="noopener">About Functions OutputTypeAttribute</a>属性值只是文档说明。 它不是从功能代码派生出来的，或者是与实际功能输出相比较的。</p>
<p>您将使用输出类型的主要原因是，有关您的函数的元信息反映了您的意图。 像<code>Get-Command</code>，<code>Get-Help</code>和你的开发环境可以利用它。 如果您想了解更多信息，请查看帮助信息：about_Functions_OutputTypeAttribute</p>
<p>这就是说，如果您正在使用Pester来测试您的函数，那么验证输出对象与您的<code>OutputType</code>匹配将是一个好主意。 当它们不应该的时候，这可以捕获刚落入管道的变量。</p>
<h3 id="最后的想法"><a href="#最后的想法" class="headerlink" title="最后的想法"></a>最后的想法</h3><p>这是关于[PSCustomObject]的全部内容，但很多这些信息适用于一般对象。<br>过去我已经看到了大部分这些功能，但从来没有看到它们作为PSCustomObject信息的集合呈现。 就在上个星期，我偶然发现了另一个，我很惊讶我之前没有看到它。 我想将所有这些想法集中在一起，以便您有望看到更大的图景，并在有机会使用它们时注意它们。 我希望你学到了一些东西，并且可以找到一种方法将它应用到脚本中。</p>
<hr>
<p>上面就是原文的内容， 下一篇讲compare 2 csv contents。</p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">超速蜗牛</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://chaoyuew.gitee.io/WPS-24-Advanced-PSCustomObject.html">https://chaoyuew.gitee.io/WPS-24-Advanced-PSCustomObject.html</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chaoyuew.gitee.io">超速蜗牛的博客</a>！</span></div></div></article><div id="pagination"><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-23-Advanced-IO-CSV-Manage.html"><span>Windows PowerShell进阶(23) IO操作之CSV</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 By 超速蜗牛</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>