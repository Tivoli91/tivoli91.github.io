<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Windows PowerShell进阶(26) 合并csv"><meta name="keywords" content="进阶,IO,CSV"><meta name="author" content="超速蜗牛,undefined"><meta name="copyright" content="超速蜗牛"><title>Windows PowerShell进阶(26) 合并csv【超速蜗牛的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"AOHMI93W80","apiKey":"3f74c7e8113768c69c3eedfd6540618f","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#背景"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析"><span class="toc-number">2.</span> <span class="toc-text">分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#针对26-2，其稍微简单些，我们来看下怎么才能得到最终结果，请认真看图："><span class="toc-number">2.1.</span> <span class="toc-text">针对26-2，其稍微简单些，我们来看下怎么才能得到最终结果，请认真看图：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#拆解"><span class="toc-number">2.1.1.</span> <span class="toc-text">拆解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#针对26-3，其较复杂，我们来看下怎么才能得到最终结果，请认真看图："><span class="toc-number">2.2.</span> <span class="toc-text">针对26-3，其较复杂，我们来看下怎么才能得到最终结果，请认真看图：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#拆解-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">拆解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#合并脚本"><span class="toc-number">3.</span> <span class="toc-text">合并脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#参数设置和日志记录函数"><span class="toc-number">3.1.</span> <span class="toc-text">参数设置和日志记录函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化各种参数"><span class="toc-number">4.</span> <span class="toc-text">初始化各种参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对于转置，表头是固定死的，对于右追加，第一列是固定死的"><span class="toc-number">5.</span> <span class="toc-text">对于转置，表头是固定死的，对于右追加，第一列是固定死的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#开始合并"><span class="toc-number">5.1.</span> <span class="toc-text">开始合并</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#完整脚本验证"><span class="toc-number">6.</span> <span class="toc-text">完整脚本验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#针对图26-2的验证"><span class="toc-number">6.1.</span> <span class="toc-text">针对图26-2的验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#针对图26-3的验证"><span class="toc-number">6.2.</span> <span class="toc-text">针对图26-3的验证</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">超速蜗牛</div><div class="author-info-description">Learn PowerShell.</div><div class="links-buttons"><a class="links-button button-hover" href="https://gitee.com/chaoyuew" target="_blank">Gitee<i class="icon-dot bg-color5"></i></a><a class="links-button button-hover" href="mailto:348001390@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color7"></i></a><a class="links-button button-hover" href="tencent://message/?uin=348001390&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color7"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">30</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">37</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">超速蜗牛的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Windows PowerShell进阶(26) 合并csv</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-08-26 | 更新于 2019-08-26</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/powershell/">powershell</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/进阶/">进阶</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/IO/">IO</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/CSV/">CSV</a></div></div></div><div class="main-content"><p>本文首发于本人公众号SPPS178,现搬运过来,较原文有所改动.</p>
<p>这篇试着讲下怎么去合并多个csv文件，这个我在工作中用到的获取一个电脑的很多信息，比如OS info,software版本等等， 然后需要把获取的信息合并到一个csv里面去。这篇可能看起来有点难度，大家自己动手画一下会加深理解。</p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>比如对于下面这样2台机器，MK01,MK02，每台机器又有2个不同的csv数据：osinfo &amp; version。</p>
<center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6de86mawjj30le0ann38.jpg"><br><div>26-1 VDI-Info</div></center>

<p>我们希望把他们合并到一个csv里面去(如下的其中一种)：</p>
<a id="more"></a>

<center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6debmerarj309c0300sl.jpg"><br><div>26-2 expected-combined-append-format</div></center>

<center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6dec1gilhj305v05dwed.jpg"><br><div>26-3 expected-combined-transpose-format</div></center>

<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><h4 id="针对26-2，其稍微简单些，我们来看下怎么才能得到最终结果，请认真看图："><a href="#针对26-2，其稍微简单些，我们来看下怎么才能得到最终结果，请认真看图：" class="headerlink" title="针对26-2，其稍微简单些，我们来看下怎么才能得到最终结果，请认真看图："></a>针对26-2，其稍微简单些，我们来看下怎么才能得到最终结果，请认真看图：</h4><center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6ded5brhhj30tw0kdatl.jpg"><br><div>26-4 How-to-combine-to-append-format-csv</div></center>

<p>如图所示有2种思路：</p>
<ul>
<li>1 &amp; 2 =&gt; 5; 3 &amp; 4 =&gt; 6 ; 5 &amp; 6 =&gt; 9, 完成。<br>其中1 &amp; 2 =&gt; 5 和 3 &amp; 4 =&gt; 6 拼接只需用export-csv -append参数即可完成<br><font color="yellow">而5 &amp; 6 =&gt; 9则要把6的列B和C 追加到5的最右边，有难度。</font></li>
<li>1 &amp; 3 =&gt; 7; 2 &amp; 4 =&gt; 8 ; 7 &amp; 8 =&gt; 9, 完成。<br><font color="yellow">其中1 &amp; 3 =&gt; 7 和 2 &amp; 4 =&gt; 8 都需要对应的把第二个csv的列B和C追加到第一个csv的最右边，有难度。</font><br>而7 &amp; 8 =&gt; 9拼接只需用export-csv -append参数即可完成</li>
</ul>
<p>export-csv -append无需考虑，我们现在要考虑的是怎么将一个csv的部分列追加到另一个csv的最右边，<font color="yellow">这里其实我们只要确保每个csv的第一列的数据顺序和值都是一样的即可，否则是不允许追加的。</font></p>
<h5 id="拆解"><a href="#拆解" class="headerlink" title="拆解"></a>拆解</h5><p>这里我们以1 &amp; 3 =&gt; 7的合并来讲解：<br>1的表头是VDI，CSize，CPUCores，Resolution<br>3的表头是VDI，Chrome，.NET<br>7的表头是VDI，CSize，CPUCores，Resolution，Chrome，.NET<br>我们可以发现7的表头是由1的所有表头 + 3的第二个开始的剩下表头（Chrome，.NET）</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$a</span>=ipcsv .\MK01-osinfo.csv ; <span class="variable">$a_header</span>=<span class="variable">$a</span>[<span class="number">0</span>].psobject.Properties|%&#123;<span class="variable">$_</span>.Name&#125;</span><br><span class="line"><span class="variable">$b</span>=ipcsv .\MK01-version.csv ; <span class="variable">$b_header</span>=<span class="variable">$b</span>[<span class="number">0</span>].psobject.Properties|%&#123;<span class="variable">$_</span>.Name&#125;</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$a_header</span></span><br><span class="line">VDI</span><br><span class="line">CSize</span><br><span class="line">CPUCores</span><br><span class="line">Resolution</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$b_header</span></span><br><span class="line">VDI</span><br><span class="line">Chrome</span><br><span class="line">.NET</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$c_header</span>= <span class="variable">$a_header</span> + <span class="variable">$b_header</span>[<span class="number">1</span> .. <span class="variable">$b_header</span>.count]</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$c_header</span></span><br><span class="line">VDI</span><br><span class="line">CSize</span><br><span class="line">CPUCores</span><br><span class="line">Resolution</span><br><span class="line">Chrome</span><br><span class="line">.NET</span><br></pre></td></tr></table></figure>

<p>那接下来我们只要创建一个hashtable，使得其所有的key为我们上面获取的表头<code>$c_header</code>，而<font color="yellow">每个key对应的value为每个表头在其本身csv里面的value即可。</font></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; </span><br><span class="line"><span class="variable">$a_fst_column</span>=<span class="variable">$a</span>|select <span class="variable">$a_header</span>[<span class="number">0</span>]</span><br><span class="line"><span class="variable">$b_fst_column</span>=<span class="variable">$b</span>|select <span class="variable">$b_header</span>[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span>(!(compare <span class="variable">$a_fst_column</span> <span class="variable">$b_fst_column</span>))&#123; <span class="comment"># no difference</span></span><br><span class="line">    <span class="variable">$c</span>=[ordered]@&#123;&#125;</span><br><span class="line">    <span class="variable">$a_header</span>|%&#123;</span><br><span class="line">        <span class="variable">$c</span>.<span class="variable">$_</span> = <span class="variable">$a</span>.<span class="variable">$_</span> <span class="comment"># assign each $a csv header value to $c header</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$b_header</span>[<span class="number">1</span> .. <span class="variable">$b_header</span>.count]|%&#123; <span class="comment"># from the 2nd header</span></span><br><span class="line">        <span class="variable">$c</span>.<span class="variable">$_</span> = <span class="variable">$b</span>.<span class="variable">$_</span> <span class="comment"># assign each $b csv header value to $c header</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$c</span></span><br><span class="line">Name                           Value</span><br><span class="line">----                           -----</span><br><span class="line">VDI                            MK01</span><br><span class="line">CSize                          <span class="number">30</span>GB</span><br><span class="line">CPUCores                       <span class="number">8</span></span><br><span class="line">Resolution                     <span class="number">1920</span>*<span class="number">1080</span></span><br><span class="line">Chrome                         <span class="number">65.0</span>.<span class="number">33</span></span><br><span class="line">.NET                           <span class="number">4.5</span></span><br></pre></td></tr></table></figure>

<p>我们看到`$c已经是我们要的结果了，剩下的就是导入到csv中即可了。</p>
<h4 id="针对26-3，其较复杂，我们来看下怎么才能得到最终结果，请认真看图："><a href="#针对26-3，其较复杂，我们来看下怎么才能得到最终结果，请认真看图：" class="headerlink" title="针对26-3，其较复杂，我们来看下怎么才能得到最终结果，请认真看图："></a>针对26-3，其较复杂，我们来看下怎么才能得到最终结果，请认真看图：</h4><center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6derysktej30sh0n3nhi.jpg"><br><div>26-5 How-to-combine-to-transpose-format-csv</div></center>

<p>如图所示也是有2种思路：</p>
<ul>
<li>1 &amp; 2 =&gt; 6; 3 &amp; 4 =&gt; 7 ; 6 &amp; 7 =&gt; 9, 完成。<br><font color="yellow">其中1 &amp; 2 =&gt; 6 和 3 &amp; 4 =&gt; 7 都需要对应的把第二个csv的列B和C追加到第一个csv的最右边，有难度。</font><br>而6 &amp; 7 =&gt; 9只需用export-csv -append参数即可完成</li>
<li>1 &amp; 3 =&gt; 5; 2 &amp; 4 =&gt; 8 ; 5 &amp; 8 =&gt; 9, 完成。<br>其中1 &amp; 3 =&gt; 5 和 2 &amp; 4 =&gt; 8 只需用export-csv -append参数即可完成<br><font color="yellow">而5 &amp; 8 =&gt; 9则要把8的列B追加到5的最右边，有难度。</font></li>
</ul>
<p>而最主要的是1,2,3,4都是原有数据的转置。这个要怎么实现？</p>
<center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6devbc5agj309004vglk.jpg"><br><div>26-5 Excel 中的转置</div></center>

<h5 id="拆解-1"><a href="#拆解-1" class="headerlink" title="拆解"></a>拆解</h5><p>这里我们以4的实现来分析用powershell如何实现转置的功能：</p>
<ul>
<li>4的表头是原有数据的第一列，即原有数据<font color="yellow">第一个表头和其每行第一个表头对应的值。</font></li>
<li>4的表头每一行对应的值是原有数据<font color="yellow">第二个表头开始，每个表头和表头对应的值</font>(有点绕，自己画个图就能明白了)</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$b</span> </span><br><span class="line"></span><br><span class="line">VDI  Chrome  .NET</span><br><span class="line">---  ------  ----</span><br><span class="line">MK01 <span class="number">65.0</span>.<span class="number">33</span> <span class="number">4.5</span> </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$d_header</span>=<span class="variable">$b_header</span>[<span class="number">0</span>],<span class="variable">$b</span>.(<span class="variable">$b_header</span>[<span class="number">0</span>]) <span class="comment"># 第一个表头和其每行第一个表头对应的值。</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$d_header</span></span><br><span class="line">VDI</span><br><span class="line">MK01</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$d</span>=@()</span><br><span class="line"><span class="variable">$b_header</span>[<span class="number">1</span> .. <span class="variable">$b_header</span>.count]|%&#123; <span class="comment"># from the 2nd header</span></span><br><span class="line">    <span class="variable">$d</span>+=[pscustomobject]@&#123;</span><br><span class="line">        <span class="variable">$b_header</span>[<span class="number">0</span>]=<span class="variable">$_</span>           <span class="comment"># 每个表头</span></span><br><span class="line">        <span class="variable">$b</span>.(<span class="variable">$b_header</span>[<span class="number">0</span>])=<span class="variable">$b</span>.<span class="variable">$_</span> <span class="comment"># 表头对应的值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt; <span class="variable">$d</span></span><br><span class="line"></span><br><span class="line">VDI    MK01   </span><br><span class="line">---    ----   </span><br><span class="line">Chrome <span class="number">65.0</span>.<span class="number">33</span></span><br><span class="line">.NET   <span class="number">4.5</span>    </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>\MK01&gt;</span><br></pre></td></tr></table></figure>

<h3 id="合并脚本"><a href="#合并脚本" class="headerlink" title="合并脚本"></a>合并脚本</h3><h4 id="参数设置和日志记录函数"><a href="#参数设置和日志记录函数" class="headerlink" title="参数设置和日志记录函数"></a>参数设置和日志记录函数</h4><ul>
<li>我们可以从一个csv的folder里面获取csv files，或者直接提供csv files数组</li>
<li>指定combine的folder（非强制）</li>
<li>combine 的方法，是”transpose”(转置)还是”RightAppend”(右追加)</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[CmdletBinding(DefaultParameterSetName=<span class="string">"Folder"</span>)]param(</span><br><span class="line">    [Parameter(ParameterSetName=<span class="string">"Folder"</span>)]</span><br><span class="line">	[ValidateScript(&#123;<span class="built_in">test-path</span> <span class="variable">$_</span>&#125;)]</span><br><span class="line">    [string]<span class="variable">$csv_folder</span>, 						<span class="comment"># get csv files from given folder</span></span><br><span class="line">    [Parameter(ParameterSetName=<span class="string">"File"</span>)]</span><br><span class="line">	[ValidateNotNullOrEmpty()]</span><br><span class="line">    [array]<span class="variable">$csv_files</span>,							<span class="comment"># get csv files from given array</span></span><br><span class="line">	[Parameter(ParameterSetName=<span class="string">"Folder"</span>)]</span><br><span class="line">	[Parameter(ParameterSetName=<span class="string">"File"</span>)]</span><br><span class="line">	[ValidateScript(&#123;<span class="built_in">test-path</span> <span class="variable">$_</span>&#125;)]</span><br><span class="line">    [string]<span class="variable">$combine_folder</span>,                    <span class="comment"># where to saved combined csv file</span></span><br><span class="line">	[Parameter(ParameterSetName=<span class="string">"Folder"</span>)]</span><br><span class="line">	[Parameter(ParameterSetName=<span class="string">"File"</span>)]</span><br><span class="line">	[ValidateSet(<span class="string">"Transpose"</span>,<span class="string">"RightAppend"</span>)]</span><br><span class="line">	[string]<span class="variable">$Method</span>=<span class="string">"Transpose"</span>					<span class="comment"># how to combine csv files</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">Function</span> <span class="built_in">Write-Log</span>()&#123;</span><br><span class="line">    [CmdletBinding()]param(</span><br><span class="line">		[Parameter(Mandatory=<span class="literal">$true</span>)]</span><br><span class="line">		[ValidateSet(<span class="string">"Warning"</span>, <span class="string">"Error"</span>, <span class="string">"Success"</span>,<span class="string">"Normal"</span>,<span class="string">"Critical"</span>)]</span><br><span class="line">		[string]<span class="variable">$log_type</span>,</span><br><span class="line">		[string]<span class="variable">$log_info</span>,</span><br><span class="line">		[string]<span class="variable">$log_file</span>=<span class="string">"$(<span class="variable">$env:TEMP</span>)\log.txt"</span>,</span><br><span class="line">        [Parameter(Mandatory=<span class="literal">$false</span>)]</span><br><span class="line">        [switch]<span class="variable">$print_to_console</span></span><br><span class="line">	)</span><br><span class="line">    <span class="keyword">If</span>( <span class="variable">$print_to_console</span> )&#123;</span><br><span class="line">        <span class="variable">$color</span> = <span class="keyword">switch</span> -regex (<span class="variable">$log_type</span>)&#123;</span><br><span class="line">            <span class="string">"Error|Critical"</span>  &#123;<span class="string">'red'</span>;<span class="keyword">break</span> &#125;</span><br><span class="line">            <span class="string">"Warning"</span>&#123;<span class="string">'yellow'</span> ;<span class="keyword">break</span>&#125;</span><br><span class="line">            <span class="string">"Success"</span>&#123;<span class="string">'green'</span>  ;<span class="keyword">break</span>&#125;</span><br><span class="line">            default &#123;<span class="string">'white'</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">write-host</span> -fore <span class="variable">$color</span> <span class="variable">$log_info</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">Do</span>&#123;</span><br><span class="line">	    <span class="keyword">Try</span>&#123;<span class="string">"&#123;0:yyyy-MM-dd HH:mm:ss&#125;--&#123;1&#125;: &#123;2&#125;"</span> -f (<span class="built_in">get-date</span>),<span class="variable">$log_type</span>,<span class="variable">$log_info</span> |<span class="built_in">Out-File</span> -FilePath <span class="variable">$log_file</span> -Append -Encoding utf8 -Force -ea <span class="number">1</span>;<span class="keyword">break</span>&#125;Catch&#123; <span class="built_in">write-host</span> <span class="variable">$_</span> ; <span class="built_in">read-host</span> <span class="string">" "</span>;sleep -Milliseconds <span class="number">200</span> ;<span class="keyword">if</span>(++<span class="variable">$cnt</span> <span class="nomarkup">-gt</span> <span class="number">10</span>)&#123;<span class="built_in">write-error</span> <span class="string">"wait too long(2s) to write log"</span>;<span class="keyword">break</span>&#125;</span><br><span class="line">		&#125;<span class="keyword">Finally</span>&#123;&#125;</span><br><span class="line">	&#125;<span class="keyword">While</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="初始化各种参数"><a href="#初始化各种参数" class="headerlink" title="初始化各种参数"></a>初始化各种参数</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">If</span>( <span class="string">'Folder'</span> <span class="nomarkup">-eq</span> <span class="variable">$pscmdlet</span>.ParameterSetName )&#123; <span class="comment"># get all csv files from given folder</span></span><br><span class="line">    <span class="variable">$csv_files</span>=ls <span class="string">"<span class="variable">$csv_folder</span>\*.csv"</span> </span><br><span class="line">	<span class="variable">$csv_folder_basename</span>=(gi <span class="variable">$csv_folder</span>).basename</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="variable">$csv_folder_basename</span>=<span class="string">'csv'</span>&#125;</span><br><span class="line"><span class="variable">$now</span>=<span class="string">"&#123;0:yyyyMMdd_HHmmss&#125;"</span> -f (<span class="built_in">get-date</span>)</span><br><span class="line"><span class="variable">$log_file</span>=<span class="string">"<span class="variable">$PSScriptRoot</span>\<span class="variable">$now</span>-combine-csv.log"</span></span><br><span class="line"><span class="keyword">If</span>( <span class="variable">$csv_files</span>.count <span class="nomarkup">-lt</span> <span class="number">2</span> )&#123;</span><br><span class="line">    <span class="built_in">write-log</span> Warning <span class="string">"Less than 2 csv files have been provided, please double cehck and run again"</span> <span class="variable">$log_file</span> -print_to_console ; <span class="keyword">exit</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">If</span>( !<span class="variable">$PSBoundParameters</span>.ContainsKey(<span class="string">'combine_folder'</span> ) )&#123; <span class="comment"># when not provide the folder to save final combined csv</span></span><br><span class="line">    <span class="keyword">Try</span>&#123;</span><br><span class="line">		<span class="variable">$combine_folder_path</span>=<span class="string">"<span class="variable">$PSScriptRoot</span>\combine-<span class="variable">$csv_folder_basename</span>"</span></span><br><span class="line">		mkdir <span class="variable">$combine_folder_path</span> -force -ea <span class="number">1</span>|<span class="built_in">out-null</span> <span class="comment"># create the combine folder</span></span><br><span class="line">		<span class="variable">$combine_folder</span>=<span class="variable">$combine_folder_path</span></span><br><span class="line">    &#125;Catch&#123;</span><br><span class="line">        <span class="built_in">write-log</span> Error <span class="variable">$_</span>.Exception.Message <span class="variable">$log_file</span> -print_to_console; <span class="keyword">exit</span></span><br><span class="line">    &#125;<span class="keyword">Finally</span>&#123;&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="variable">$combine_folder</span>=(gi <span class="variable">$combine_folder</span>).fullname&#125;</span><br><span class="line"><span class="variable">$combine_csv</span>=<span class="string">"<span class="variable">$combine_folder</span>\<span class="variable">$now</span>-combine-<span class="variable">$csv_folder_basename</span>-<span class="variable">$Method</span>.csv"</span> <span class="comment"># initilize the csv to save all combined data</span></span><br></pre></td></tr></table></figure>

<h3 id="对于转置，表头是固定死的，对于右追加，第一列是固定死的"><a href="#对于转置，表头是固定死的，对于右追加，第一列是固定死的" class="headerlink" title="对于转置，表头是固定死的，对于右追加，第一列是固定死的"></a>对于转置，表头是固定死的，对于右追加，第一列是固定死的</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$csv_header</span>=([array]<span class="variable">$csv_object</span>=ipcsv <span class="variable">$csv_files</span>[<span class="number">0</span>])[<span class="number">0</span>].psobject.Properties|%&#123;<span class="variable">$_</span>.Name&#125; <span class="comment"># the 1st csv file header, aslo should be same for all other csv files</span></span><br><span class="line"><span class="keyword">If</span>( <span class="string">"Transpose"</span> <span class="nomarkup">-eq</span> <span class="variable">$Method</span> )&#123; <span class="comment"># for Transpose method, we need to initilize the new csv header</span></span><br><span class="line">	<span class="variable">$combine_csv_header</span>=<span class="variable">$csv_header</span>[<span class="number">0</span>],<span class="variable">$csv_object</span>.(<span class="variable">$csv_header</span>[<span class="number">0</span>]) <span class="comment"># Transpose 1st csv's 1st column value as combined csv's header</span></span><br><span class="line">	del <span class="variable">$combine_csv</span> -force -ea <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$csv_fst_column</span>=<span class="variable">$csv_object</span>|select <span class="variable">$csv_header</span>[<span class="number">0</span>] <span class="comment"># for later compare if 2 csv files have same 1st column value</span></span><br></pre></td></tr></table></figure>

<h4 id="开始合并"><a href="#开始合并" class="headerlink" title="开始合并"></a>开始合并</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">For</span>( <span class="variable">$n</span>=<span class="number">0</span>; <span class="variable">$n</span> <span class="nomarkup">-lt</span> <span class="variable">$csv_files</span>.count; <span class="variable">$n</span>++ )&#123; <span class="comment"># do not use same count variable name in the loop</span></span><br><span class="line">	<span class="keyword">If</span>( <span class="variable">$n</span> <span class="nomarkup">-gt</span> <span class="number">0</span> )&#123; <span class="comment"># as we already read the 1st csv, so we continue to read csv from the 2nd one</span></span><br><span class="line">		<span class="variable">$this_csv_header</span>=([array]<span class="variable">$this_csv</span>=ipcsv <span class="variable">$csv_files</span>[<span class="variable">$n</span>])[<span class="number">0</span>].psobject.Properties | % &#123; <span class="variable">$_</span>.Name&#125; <span class="comment"># current csv header</span></span><br><span class="line">		<span class="keyword">If</span>( <span class="string">"Transpose"</span> <span class="nomarkup">-eq</span> <span class="variable">$Method</span> )&#123; <span class="variable">$csv_header</span>=<span class="variable">$this_csv_header</span> ;  [array]<span class="variable">$csv_object</span>=<span class="variable">$this_csv</span>&#125;</span><br><span class="line">		<span class="keyword">Try</span>&#123; <span class="comment"># check if current csv has same 1st column value to the 1st csv's 1st column value</span></span><br><span class="line">			<span class="keyword">If</span>( compare <span class="variable">$csv_fst_column</span> (<span class="variable">$this_csv</span>|select <span class="variable">$csv_header</span>[<span class="number">0</span>]) -ea <span class="number">1</span>)&#123; </span><br><span class="line">				<span class="built_in">write-error</span> <span class="string">"Found different 1st column value in $(<span class="variable">$csv_files</span>[<span class="variable">$n</span>])"</span> ; <span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;Catch&#123;</span><br><span class="line">		    <span class="built_in">write-log</span> Error <span class="variable">$_</span>.Exception.Message <span class="variable">$log_file</span> ; <span class="keyword">continue</span></span><br><span class="line">		&#125;<span class="keyword">Finally</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">If</span>( <span class="string">"Transpose"</span> <span class="nomarkup">-eq</span> <span class="variable">$Method</span> )&#123;</span><br><span class="line">		<span class="keyword">For</span>( <span class="variable">$j</span>=<span class="number">1</span>; <span class="variable">$j</span> <span class="nomarkup">-lt</span> <span class="variable">$csv_header</span>.count; <span class="variable">$j</span>++ )&#123; <span class="comment"># VDI	CSize	CPUCores	Resolution</span></span><br><span class="line">		    <span class="variable">$csv_hash</span>=[ordered]@&#123;<span class="variable">$combine_csv_header</span>[<span class="number">0</span>]=<span class="variable">$csv_header</span>[<span class="variable">$j</span>]&#125;</span><br><span class="line">			<span class="keyword">For</span>( <span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span> <span class="nomarkup">-lt</span> <span class="variable">$combine_csv_header</span>.count; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">			    <span class="variable">$csv_hash</span>.(<span class="variable">$combine_csv_header</span>[<span class="variable">$i</span>])=<span class="variable">$csv_object</span>[<span class="variable">$i</span> - <span class="number">1</span>].(<span class="variable">$csv_header</span>[<span class="variable">$j</span>])</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">Try</span>&#123;</span><br><span class="line">				<span class="built_in">export-csv</span> -Path <span class="variable">$combine_csv</span> -InputObject ([PSCustomObject]<span class="variable">$csv_hash</span>) -Append -NoTypeInformation -force</span><br><span class="line">			&#125;Catch&#123;</span><br><span class="line">			    <span class="built_in">write-log</span> Error <span class="variable">$_</span>.Exception.Message <span class="variable">$log_file</span> ; <span class="keyword">exit</span> </span><br><span class="line">			&#125;<span class="keyword">Finally</span>&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">elseif</span>(<span class="string">"RightAppend"</span> <span class="nomarkup">-eq</span> <span class="variable">$Method</span>)&#123;</span><br><span class="line">	    <span class="variable">$temp_csv_object</span>=@()</span><br><span class="line">		<span class="keyword">For</span>( <span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> <span class="nomarkup">-lt</span> <span class="variable">$csv_object</span>.count; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">			<span class="variable">$csv_hash</span>=[ordered]@&#123;&#125;</span><br><span class="line">			<span class="variable">$csv_header</span>|%&#123;</span><br><span class="line">				<span class="variable">$csv_hash</span>.<span class="variable">$_</span>=<span class="variable">$csv_object</span>[<span class="variable">$i</span>].<span class="variable">$_</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$this_csv_header</span>[<span class="number">1</span> .. <span class="variable">$this_csv_header</span>.count]|%&#123;</span><br><span class="line">				<span class="variable">$csv_hash</span>.<span class="variable">$_</span>=<span class="variable">$this_csv</span>[<span class="variable">$i</span>].<span class="variable">$_</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$temp_csv_object</span>+= [PSCustomObject]<span class="variable">$csv_hash</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$csv_object</span>=<span class="variable">$temp_csv_object</span> <span class="comment"># the new combined csv object</span></span><br><span class="line">		<span class="keyword">If</span>( <span class="variable">$n</span> <span class="nomarkup">-lt</span> <span class="variable">$this_csvs</span>.count )&#123;</span><br><span class="line">			<span class="variable">$csv_header</span>=<span class="variable">$csv_object</span>[<span class="number">0</span>].psobject.Properties | % &#123; <span class="variable">$_</span>.Name &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">If</span>( <span class="string">"RightAppend"</span> <span class="nomarkup">-eq</span> <span class="variable">$Method</span> )&#123;</span><br><span class="line">	<span class="keyword">Try</span>&#123;</span><br><span class="line">		<span class="variable">$csv_object</span>|<span class="built_in">export-csv</span> -Path <span class="variable">$combine_csv</span> -NoTypeInformation -force -ea <span class="number">1</span></span><br><span class="line">	&#125;Catch&#123;</span><br><span class="line">	    <span class="built_in">write-log</span> Error <span class="variable">$_</span>.Exception.Message <span class="variable">$log_file</span></span><br><span class="line">	&#125;<span class="keyword">Finally</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">write-log</span> Success <span class="string">"The combined data has been saved in '<span class="variable">$combine_csv</span>'"</span> <span class="variable">$log_file</span> -print_to_console</span><br></pre></td></tr></table></figure>

<h3 id="完整脚本验证"><a href="#完整脚本验证" class="headerlink" title="完整脚本验证"></a>完整脚本验证</h3><h4 id="针对图26-2的验证"><a href="#针对图26-2的验证" class="headerlink" title="针对图26-2的验证"></a>针对图26-2的验证</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------- for MK01 combine</span></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv .\mk01\MK01-osinfo.csv</span><br><span class="line"></span><br><span class="line">VDI  CSize CPUCores Resolution</span><br><span class="line">---  ----- -------- ----------</span><br><span class="line">MK01 <span class="number">30</span>GB  <span class="number">8</span>        <span class="number">1920</span>*<span class="number">1080</span> </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv .\mk01\MK01-version.csv</span><br><span class="line"></span><br><span class="line">VDI  Chrome  .NET</span><br><span class="line">---  ------  ----</span><br><span class="line">MK01 <span class="number">65.0</span>.<span class="number">33</span> <span class="number">4.5</span> </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; .\Combine-Csv.ps1 -csv_folder .\mk01 -combine_folder .\combine -Method RightAppend</span><br><span class="line">The combined <span class="keyword">data</span> has been saved <span class="keyword">in</span> <span class="string">'C:\Users\SPPS\26\combine\20180520_224939-combine-mk01-RightAppend.csv'</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv <span class="string">'C:\Users\SPPS\26\combine\20180520_224939-combine-mk01-RightAppend.csv'</span>|ft</span><br><span class="line"></span><br><span class="line">VDI  CSize CPUCores Resolution Chrome  .NET</span><br><span class="line">---  ----- -------- ---------- ------  ----</span><br><span class="line">MK01 <span class="number">30</span>GB  <span class="number">8</span>        <span class="number">1920</span>*<span class="number">1080</span>  <span class="number">65.0</span>.<span class="number">33</span> <span class="number">4.5</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------- for MK02 combine</span></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv .\mk02\MK02-osinfo.csv</span><br><span class="line"></span><br><span class="line">VDI  CSize CPUCores Resolution</span><br><span class="line">---  ----- -------- ----------</span><br><span class="line">MK02 <span class="number">50</span>GB  <span class="number">4</span>        <span class="number">1280</span>*<span class="number">960</span>  </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv .\mk02\MK02-version.csv</span><br><span class="line"></span><br><span class="line">VDI  Chrome  .NET</span><br><span class="line">---  ------  ----</span><br><span class="line">MK02 <span class="number">63.1</span>.<span class="number">22</span> <span class="number">4.3</span> </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; .\Combine-Csv.ps1 -csv_folder .\mk02 -combine_folder .\combine -Method RightAppend</span><br><span class="line">The combined <span class="keyword">data</span> has been saved <span class="keyword">in</span> <span class="string">'C:\Users\SPPS\26\combine\20180520_224955-combine-mk02-RightAppend.csv'</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv <span class="string">'C:\Users\SPPS\26\combine\20180520_224955-combine-mk02-RightAppend.csv'</span>|ft</span><br><span class="line"></span><br><span class="line">VDI  CSize CPUCores Resolution Chrome  .NET</span><br><span class="line">---  ----- -------- ---------- ------  ----</span><br><span class="line">MK02 <span class="number">50</span>GB  <span class="number">4</span>        <span class="number">1280</span>*<span class="number">960</span>   <span class="number">63.1</span>.<span class="number">22</span> <span class="number">4.3</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------- final combine, use export-csv -append</span></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ls .\combine\*.csv|%&#123;</span><br><span class="line">    ipcsv <span class="variable">$_</span>.FullName|<span class="built_in">Export-Csv</span> .\combine\final_combine_report-append.csv -NoTypeInformation -Append</span><br><span class="line">&#125;</span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv .\combine\final_combine_report-append.csv|ft</span><br><span class="line"></span><br><span class="line">VDI  CSize CPUCores Resolution Chrome  .NET</span><br><span class="line">---  ----- -------- ---------- ------  ----</span><br><span class="line">MK01 <span class="number">30</span>GB  <span class="number">8</span>        <span class="number">1920</span>*<span class="number">1080</span>  <span class="number">65.0</span>.<span class="number">33</span> <span class="number">4.5</span> </span><br><span class="line">MK02 <span class="number">50</span>GB  <span class="number">4</span>        <span class="number">1280</span>*<span class="number">960</span>   <span class="number">63.1</span>.<span class="number">22</span> <span class="number">4.3</span> </span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="针对图26-3的验证"><a href="#针对图26-3的验证" class="headerlink" title="针对图26-3的验证"></a>针对图26-3的验证</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------- for MK01 combine</span></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; .\Combine-Csv.ps1 -csv_folder .\mk01 -combine_folder .\combine -Method Traverse</span><br><span class="line">The combined <span class="keyword">data</span> has been saved <span class="keyword">in</span> <span class="string">'C:\Users\SPPS\26\combine\20180520_225952-combine-mk01-Traverse.csv'</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv <span class="string">'C:\Users\SPPS\26\combine\20180520_225952-combine-mk01-Traverse.csv'</span></span><br><span class="line"></span><br><span class="line">VDI        MK01     </span><br><span class="line">---        ----     </span><br><span class="line">CSize      <span class="number">30</span>GB     </span><br><span class="line">CPUCores   <span class="number">8</span>        </span><br><span class="line">Resolution <span class="number">1920</span>*<span class="number">1080</span></span><br><span class="line">Chrome     <span class="number">65.0</span>.<span class="number">33</span>  </span><br><span class="line">.NET       <span class="number">4.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------- for MK02 combine</span></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; .\Combine-Csv.ps1 -csv_folder .\mk02 -combine_folder .\combine -Method Traverse</span><br><span class="line">The combined <span class="keyword">data</span> has been saved <span class="keyword">in</span> <span class="string">'C:\Users\SPPS\26\combine\20180520_230055-combine-mk02-Traverse.csv'</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv <span class="string">'C:\Users\SPPS\26\combine\20180520_230055-combine-mk02-Traverse.csv'</span></span><br><span class="line"></span><br><span class="line">VDI        MK02    </span><br><span class="line">---        ----    </span><br><span class="line">CSize      <span class="number">50</span>GB    </span><br><span class="line">CPUCores   <span class="number">4</span>       </span><br><span class="line">Resolution <span class="number">1280</span>*<span class="number">960</span></span><br><span class="line">Chrome     <span class="number">63.1</span>.<span class="number">22</span> </span><br><span class="line">.NET       <span class="number">4.3</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------- final combine, use RightAppend method</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; (ls .\combine\*traverse*.csv).FullName</span><br><span class="line">C:\Users\SPPS\<span class="number">26</span>\combine\<span class="number">20180520</span>_225952-combine-mk01-Traverse.csv</span><br><span class="line">C:\Users\SPPS\<span class="number">26</span>\combine\<span class="number">20180520</span>_230055-combine-mk02-Traverse.csv</span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; .\Combine-Csv.ps1 -csv_files (ls .\combine\*traverse*.csv).FullName -combine_folder .\combine -Method RightAppend</span><br><span class="line">The combined <span class="keyword">data</span> has been saved <span class="keyword">in</span> <span class="string">'C:\Users\SPPS\26\combine\20180520_230241-combine-csv-RightAppend.csv'</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt; ipcsv <span class="string">'C:\Users\SPPS\26\combine\20180520_230241-combine-csv-RightAppend.csv'</span></span><br><span class="line"></span><br><span class="line">VDI        MK01      MK02    </span><br><span class="line">---        ----      ----    </span><br><span class="line">CSize      <span class="number">30</span>GB      <span class="number">50</span>GB    </span><br><span class="line">CPUCores   <span class="number">8</span>         <span class="number">4</span>       </span><br><span class="line">Resolution <span class="number">1920</span>*<span class="number">1080</span> <span class="number">1280</span>*<span class="number">960</span></span><br><span class="line">Chrome     <span class="number">65.0</span>.<span class="number">33</span>   <span class="number">63.1</span>.<span class="number">22</span> </span><br><span class="line">.NET       <span class="number">4.5</span>       <span class="number">4.3</span>     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\Users\SPPS\<span class="number">26</span>&gt;</span><br></pre></td></tr></table></figure>

<p>ok全部搞定，完整代码及文件在我的码云<a href="https://gitee.com/chaoyuew/powershell/tree/feature/wechat/SPPS26" target="_blank" rel="noopener">https://gitee.com/chaoyuew/powershell/tree/feature/wechat/SPPS26</a></p>
<p>总结：本篇内容不多，但是主要需要逻辑清晰。我暂时还没有测试对于几十，上百万行的数据，这个脚本的速度如何，我之前是用对待文本的方法来处理的，这个是周末写的时候自己摸索出来的一个方法，其实还可以用powershell打开Excel然后调用VBA来实现，这个以后有机会再讲吧。暂时没想好下一篇讲什么，待续。。。</p>
<center><img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="http://ww1.sinaimg.cn/large/007tGxtGgy1g6df987t8ij30u00klhdt.jpg"></center></div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">超速蜗牛</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://chaoyuew.gitee.io/WPS-26-Advanced-Merge-Csv.html">https://chaoyuew.gitee.io/WPS-26-Advanced-Merge-Csv.html</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chaoyuew.gitee.io">超速蜗牛的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-27-Advanced-PSBASE-And-More.html"><i class="fas fa-angle-left">&nbsp;</i><span>Windows PowerShell进阶(27) PSBASE and more</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/WPS-25-Advanced-Compare-Csv.html"><span>Windows PowerShell进阶(25) 比较2个csv的差异</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 By 超速蜗牛</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>